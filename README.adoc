= {project-name} (Markdown to AsciiDoc)
Dan Allen <https://github.com/mojavelinux>
// Aliases:
:project-name: Kramdown AsciiDoc
:project-handle: kramdown-asciidoc
// Settings:
:idprefix:
:idseparator: -
ifndef::env-github[:icons: font]
ifdef::env-github,env-browser[]
:toc: preamble
:toclevels: 1
endif::[]
ifdef::env-github[]
:status:
:!toc-title:
:note-caption: :paperclip:
:tip-caption: :bulb:
endif::[]
// URIs:
:uri-repo: https://github.com/asciidoctor/kramdown-asciidoc
:uri-asciidoc: https://asciidoctor.org/docs/what-is-asciidoc/#what-is-asciidoc
:uri-asciidoctor: https://asciidoctor.org
:uri-kramdown: https://kramdown.gettalong.org
:uri-rvm: https://rvm.io
:uri-rvm-install: https://rvm.io/rvm/install
:uri-ci-appveyor: https://ci.appveyor.com/project/asciidoctor/kramdown-asciidoc
:img-ci-appveyor: https://ci.appveyor.com/api/projects/status/2pwvdbcoeux1ifb5/branch/master?svg=true
:uri-ci-travis: https://travis-ci.org/asciidoctor/kramdown-asciidoc
:uri-ci-travis-img: https://img.shields.io/travis/asciidoctor/kramdown-asciidoc/master.svg
:uri-gem: https://rubygems.org/gems/kramdown-asciidoc
:uri-gem-img: https://img.shields.io/gem/v/kramdown-asciidoc.svg?label=gem

ifdef::status[]
image:{uri-gem-img}[Gem Version,link={uri-gem}]
image:{uri-ci-travis-img}[Build Status (Travis CI),link={uri-ci-travis}]
image:{img-ci-appveyor}[Build Status (AppVeyor),link={uri-ci-appveyor}]
endif::[]

{uri-repo}[{project-name}] (gem: *{project-handle}*) is a {uri-kramdown}[kramdown] extension for converting Markdown documents to {uri-asciidoc}[AsciiDoc].
Notably, the converter generates modern AsciiDoc syntax suitable for use with {uri-asciidoctor}[Asciidoctor].

== Prerequisites

To install and run {project-name}, you need Ruby 2.4 or better installed and a few RubyGems (aka gems).
We'll explain how to install the gems in the next section.

To check whether you have Ruby installed, and which version, run the following command:

 $ ruby -v

If Ruby is not installed, you can install it using {uri-rvm}[RVM] (or, if you prefer, the package manager for your system).
We generally recommend using RVM because it allows you to install gems without requiring elevated privileges or messing with system libraries.

== Installation

{project-name} is published to RubyGems.org as a pre-release gem named *{project-handle}*.

You can install the pre-release version using the following command:

 $ gem install kramdown-asciidoc --pre

Installing this gem makes the `kramdoc` command available on your $PATH.

TIP: To test a feature that's not yet released, you can <<Development,run the application from source>>.

== Usage

To convert a Markdown file to AsciiDoc using {project-name}, pass the name of the file to the `kramdoc` command as follows:

 $ kramdoc sample.md

By default, the `kramdoc` command automatically creates the output file [.path]_sample.adoc_ in the same folder as the input file.
This path is calculated by removing the Markdown file extension, `.md`, and replacing it with the AsciiDoc file extension, `.adoc`.

NOTE: The converter assumes the input uses the GitHub-flavor Markdown (GFM) syntax.

If you want to direct the output to a different file, pass the name of that file to the `kramdoc` command using the `-o` option as follows:

 $ kramdoc -o result.adoc sample.md

To direct the output to the console (i.e., STDOUT) instead of a file, use the special value `-` as follows:

 $ kramdoc -o - sample.md

To see all the options the `kramdoc` command accepts, pass the `-h` option to the `kramdoc` command as follows:

 $ kramdoc -h

For example, you can inject attributes (key/value pairs) into the header of the AsciiDoc output document using the `-a` option.

 $ kramdoc -a product-name="ACME Cloud" -a hide-uri-scheme sample.md

Another use for attributes is setting the shared images directory, which is coverd in the next section.

== Configure shared images directory

If the images in the source document share a common directory prefix, such as [.path]_images/_, you can configure the converter to extract that prefix, optionally promoting it to the document header.

Let's assume you want to convert the following Markdown source:

[source,markdown]
----
# Document Title

![Octocat](images/octocat.png)
----

You can extract the [.path]_images/_ prefix from the image reference and promote this value to the header of the output document by setting the `imagesdir` attribute:

 $ kramdoc -a imagesdir=images sample.md

Setting this attribute will produce the following document:

[source,asciidoc]
----
= Document Title
:imagesdir: images

image::octocat.png[Octocat]
----

If you want the [.path]_images/_ prefix to be removed altogether and not added to the document header (i.e., an implied prefix), set the `--imagesdir` option instead:

 $ kramdoc --imagesdir=images sample.md

Setting this option will produce the following document:

[source,asciidoc]
----
= Document Title

image::octocat.png[Octocat]
----

In this scenario, you may need to pass the `imagesdir` attribute to the AsciiDoc processor when converting the output document so the image is resolved, depending on where the image is stored.

== Development

To help develop {project-name}, or to simply test-drive the development version, you need to retrieve the source from GitHub.
Follow the instructions below to learn how to clone the source and run the application from source (i.e., your clone).

=== Retrieve the source code

Simply copy the {uri-repo}[GitHub repository URL] and pass it to the `git clone` command:

[subs=attributes+]
 $ git clone {uri-repo}

Next, switch to the project directory:

[subs=attributes+]
 $ cd {project-handle}

=== Prepare RVM (optional)

We recommend using {uri-rvm}[RVM] when developing applications with Ruby.
We like RVM because it keeps the dependencies required by the project isolated from the rest of your system.
Follow the {uri-rvm-install}[installation instructions] on the RVM site to setup RVM and install Ruby.

Once you have RVM setup, switch to the RVM-managed version of Ruby recommended by the project using this command:

 $ rvm use

The recommended version of Ruby is defined in the [.path]_.ruby-version_ file at the root of the project.

=== Install the dependencies

The dependencies needed to use {project-name} are defined in the [.path]_Gemfile_ at the root of the project.
You'll use Bundler to install these dependencies.

To check if you have Bundler available, use the `bundle` command to query the version installed:

 $ bundle --version

If Bundler is not installed, use the `gem` command to install it.

 $ gem install bundler

Then, use the `bundle` command to install the project dependencies under the project directory:

 $ bundle --path=.bundle/gems

NOTE: You must invoke `bundle` from the project's root directory so it can locate the [.path]_Gemfile_.

=== Run the Tests

The test suite is located in the [.path]_spec_ directory.
The tests are all based on RSpec.

Most specs are scenarios, located under the [.path]_spec/scenarios_ directory.
Each scenario consists of a Markdown file that ends in .md (the given), an AsciiDoc file that ends in .adoc (the then), and an optional options file that ends in .opts.
The test converts the Markdown to AsciiDoc (the when) and validates the result against what's expected.
The specification name of each scenario is derived from the directory name.

You can run all of the tests using Rake:

 $ bundle exec rake

For more fine-grained control, you can also run the tests directly using RSpec:

 $ bundle exec rspec

To run all the scenarios, point RSpec at the spec file:

 $ bundle exec rspec spec/scenario_spec.rb

==== Run Individual Tests

If you only want to run a single test, or a group of tests, you can do so by tagging the test cases, then filtering the test run using that tag.

Start by adding the `wip` tag to one or more specifications:

[source,ruby]
----
it 'should do something new', wip: true do
  expect(true).to be true
end
----

Next, run RSpec with the `wip` flag enabled:

 $ bundle exec rspec -t wip

RSpec will only run the specifications that contain this flag.

You can also filter tests by keyword.
Let's assume we want to run all the tests that have `wrap` in the description.
Run RSpec with the example filter:

 $ bundle exec rspec -e wrap

RSpec will only run the specifications that have a description containing the text `wrap`.

=== Usage

When running the `kramdoc` command from source, you must prefix the command with `bundle exec`:

 $ bundle exec kramdoc sample.md

To avoid having to do this, or make the `kramdoc` command available from anywhere, you need to build the development gem and install it.

== Alternatives

* https://github.com/bodiam/markdown-to-asciidoc[markdown-to-asciidoc] (Java library)
* http://pandoc.org[pandoc] (Haskell-based CLI tool)

== Authors

*{project-name}* was written by {email}[{author}].

== Copyright

Copyright (C) 2016-2018 OpenDevise Inc. (on behalf of the Asciidoctor Project).
Free use of this software is granted under the terms of the MIT License.

See the link:LICENSE.adoc[LICENSE] file for details.
